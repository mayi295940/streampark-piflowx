// https://github.com/d3/d3-delaunay Version 2.0.1. Copyright 2018 Observable, Inc.
// https://github.com/mapbox/delaunator Version 1.0.5. Copyright 2017, Mapbox, Inc.
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.d3=t.d3||{})}(this,function(t){"use strict";class i{constructor(t){this.voronoi=t,this.triangles=[],this.v0=null,this.vn=null}_points(){const{triangles:t,voronoi:{circumcenters:i}}=this;if(null===t)return null;const e=new Float64Array(2*t.length);for(let n=0,s=t.length;n<s;++n){const s=2*n,h=2*t[n];e[s]=i[h],e[s+1]=i[h+1]}return e}render(t){const{v0:i,vn:e}=this;let n;if(null!==(n=this._points())&&null!==(n=this.voronoi._clip(n,i,e))){t.moveTo(n[0],n[1]);for(let i=2,e=n.length;i<e;i+=2)t.lineTo(n[i],n[i+1]);t.closePath()}}contains(t,i){const s=this._points();return null!==s&&(null===this.v0?e(s,t,i):n(s,this.v0,this.vn,t,i))}}function e(t,i,e){const n=t.length;let s,h,r=t[n-2],l=t[n-1];for(let o=0;o<n;o+=2)if(s=r,h=l,((r=t[o])-s)*(e-h)<((l=t[o+1])-h)*(i-s))return!1;return!0}function n(t,[i,e],[n,s],h,r){const l=t.length;let o,a,c=t[0],f=t[1];if((o+i-h)*(f-r)<(a+e-r)*(c-h))return!1;for(let i=2;i<l;i+=2)if(o=c,a=f,c=t[i],(o-h)*((f=t[i+1])-r)<(a-r)*(c-h))return!1;return!((o-h)*(f+s-r)<(a-r)*(c+n-h))}var s=r,h=r;function r(t,i,e){i||(i=g),e||(e=m);for(var n=1/0,s=1/0,h=-1/0,r=-1/0,d=this.coords=[],y=this.ids=new Uint32Array(t.length),v=0;v<t.length;v++){var _=t[v],p=i(_),w=e(_);y[v]=v,d[2*v]=p,d[2*v+1]=w,p<n&&(n=p),w<s&&(s=w),p>h&&(h=p),w>r&&(r=w)}var T,b,k,M=(n+h)/2,z=(s+r)/2,E=1/0;for(v=0;v<t.length;v++){var A=l(M,z,d[2*v],d[2*v+1]);A<E&&(T=v,E=A)}for(E=1/0,v=0;v<t.length;v++)v!==T&&(A=l(d[2*T],d[2*T+1],d[2*v],d[2*v+1]))<E&&A>0&&(b=v,E=A);var S=1/0;for(v=0;v<t.length;v++)if(v!==T&&v!==b){var j=a(d[2*T],d[2*T+1],d[2*b],d[2*b+1],d[2*v],d[2*v+1]);j<S&&(k=v,S=j)}if(S===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(o(d[2*T],d[2*T+1],d[2*b],d[2*b+1],d[2*k],d[2*k+1])<0){var F=b;b=k,k=F}var I=d[2*T],L=d[2*T+1],K=d[2*b],P=d[2*b+1],D=d[2*k],H=d[2*k+1],U=function(t,i,e,n,s,h){var r=(e-=t)*e+(n-=i)*n,l=(s-=t)*s+(h-=i)*h,o=e*h-n*s;return{x:t+.5*(h*r-n*l)/o,y:i+.5*(e*l-s*r)/o}}(I,L,K,P,D,H);for(this._cx=U.x,this._cy=U.y,function t(i,e,n,s,h,r){var l,o,a;if(s-n<=20)for(l=n+1;l<=s;l++){for(a=i[l],o=l-1;o>=n&&u(e,i[o],a,h,r)>0;)i[o+1]=i[o--];i[o+1]=a}else{var c=n+s>>1;for(o=s,x(i,c,l=n+1),u(e,i[n],i[s],h,r)>0&&x(i,n,s),u(e,i[l],i[s],h,r)>0&&x(i,l,s),u(e,i[n],i[l],h,r)>0&&x(i,n,l),a=i[l];;){do{l++}while(u(e,i[l],a,h,r)<0);do{o--}while(u(e,i[o],a,h,r)>0);if(o<l)break;x(i,l,o)}i[n+1]=i[o],i[o]=a,s-l+1>=o-n?(t(i,e,l,s,h,r),t(i,e,n,o-1,h,r)):(t(i,e,n,o-1,h,r),t(i,e,l,s,h,r))}}(y,d,0,y.length-1,U.x,U.y),this._hashSize=Math.ceil(Math.sqrt(t.length)),this._hash=[],v=0;v<this._hashSize;v++)this._hash[v]=null;var q=this.hull=c(d,T);this._hashEdge(q),q.t=0,q=c(d,b,q),this._hashEdge(q),q.t=1,q=c(d,k,q),this._hashEdge(q),q.t=2;var B,C,N=2*t.length-5,O=this.triangles=new Uint32Array(3*N),V=this.halfedges=new Int32Array(3*N);this.trianglesLen=0,this._addTriangle(T,b,k,-1,-1,-1);for(var G=0;G<y.length;G++)if(p=d[2*(v=y[G])],w=d[2*v+1],!(p===B&&w===C||(B=p,C=w,p===I&&w===L||p===K&&w===P||p===D&&w===H))){var J,Q=this._hashKey(p,w),R=Q;do{J=this._hash[R],R=(R+1)%this._hashSize}while((!J||J.removed)&&R!==Q);for(q=J;o(p,w,q.x,q.y,q.next.x,q.next.y)>=0;)if((q=q.next)===J)throw new Error("Something is wrong with the input points.");var W=q===J,X=this._addTriangle(q.i,v,q.next.i,-1,-1,q.t);q.t=X,(q=c(d,v,q)).t=this._legalize(X+2),q.prev.prev.t===V[X+1]&&(q.prev.prev.t=X+2);for(var Y=q.next;o(p,w,Y.x,Y.y,Y.next.x,Y.next.y)<0;)X=this._addTriangle(Y.i,v,Y.next.i,Y.prev.t,-1,Y.t),Y.prev.t=this._legalize(X+2),this.hull=f(Y),Y=Y.next;if(W)for(Y=q.prev;o(p,w,Y.prev.x,Y.prev.y,Y.x,Y.y)<0;)X=this._addTriangle(Y.prev.i,v,Y.i,-1,Y.t,Y.prev.t),this._legalize(X+2),Y.prev.t=X,this.hull=f(Y),Y=Y.prev;this._hashEdge(q),this._hashEdge(q.prev)}this.triangles=O.subarray(0,this.trianglesLen),this.halfedges=V.subarray(0,this.trianglesLen)}function l(t,i,e,n){var s=t-e,h=i-n;return s*s+h*h}function o(t,i,e,n,s,h){return(n-i)*(s-e)-(e-t)*(h-n)}function a(t,i,e,n,s,h){var r=(e-=t)*e+(n-=i)*n,l=(s-=t)*s+(h-=i)*h;if(0===r||0===l)return 1/0;var o=e*h-n*s;if(0===o)return 1/0;var a=.5*(h*r-n*l)/o,c=.5*(e*l-s*r)/o;return a*a+c*c}function c(t,i,e){var n={i:i,x:t[2*i],y:t[2*i+1],t:0,prev:null,next:null,removed:!1};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function f(t){return t.prev.next=t.next,t.next.prev=t.prev,t.removed=!0,t.prev}function u(t,i,e,n,s){return l(t[2*i],t[2*i+1],n,s)-l(t[2*e],t[2*e+1],n,s)||t[2*i]-t[2*e]||t[2*i+1]-t[2*e+1]}function x(t,i,e){var n=t[i];t[i]=t[e],t[e]=n}function g(t){return t[0]}function m(t){return t[1]}r.prototype={_hashEdge:function(t){this._hash[this._hashKey(t.x,t.y)]=t},_hashKey:function(t,i){var e=t-this._cx,n=i-this._cy,s=1-e/(Math.abs(e)+Math.abs(n));return Math.floor((2+(n<0?-s:s))/4*this._hashSize)},_legalize:function(t){var i,e,n,s,h,r,l,o,a,c,f=this.triangles,u=this.coords,x=this.halfedges,g=x[t],m=t-t%3,d=g-g%3,y=m+(t+1)%3,v=m+(t+2)%3,_=d+(g+2)%3,p=f[v],w=f[t],T=f[y],b=f[_];if(i=u[2*p],e=u[2*p+1],n=u[2*w],s=u[2*w+1],h=u[2*T],r=u[2*T+1],l=u[2*b],o=u[2*b+1],a=(n-=l)*n+(s-=o)*s,c=(h-=l)*h+(r-=o)*r,(i-=l)*(s*c-a*r)-(e-=o)*(n*c-a*h)+(i*i+e*e)*(n*r-s*h)<0){f[t]=b,f[g]=p,this._link(t,x[_]),this._link(g,x[v]),this._link(v,_);var k=d+(g+1)%3;return this._legalize(t),this._legalize(k)}return v},_link:function(t,i){this.halfedges[t]=i,-1!==i&&(this.halfedges[i]=t)},_addTriangle:function(t,i,e,n,s,h){var r=this.trianglesLen;return this.triangles[r]=t,this.triangles[r+1]=i,this.triangles[r+2]=e,this._link(r,n),this._link(r+1,s),this._link(r+2,h),this.trianglesLen+=3,r}},s.default=h;class d{constructor(t,i,e,n,s,h,r){if(!((h=+h)>=(n=+n)&&(r=+r)>=(s=+s)))throw new Error("invalid bounds");this.cells=t,this.circumcenters=i,this.delaunay=e,this.xmax=h,this.xmin=n,this.ymax=r,this.ymin=s}find(t,i){return this.cells[this.findIndex(t,i)]}findIndex(t,i){const{cells:e,delaunay:{halfedges:n,points:s,triangles:h}}=this;if(0===e.length||(t=+t)!=t||(i=+i)!=i)return-1;let r=0,l=(t-s[0])**2+(i-s[1])**2;for(;;){let n=r,o=l;for(let l=e[r].triangles,a=0,c=l.length;a<c;++a){let e=3*l[a];switch(r){case h[e]:e=h[e+1];break;case h[e+1]:e=h[e+2];break;case h[e+2]:e=h[e]}let c=(t-s[2*e])**2+(i-s[2*e+1])**2;c<o&&(o=c,n=e)}if(n===r)return n;r=n,l=o}}render(t){const{cells:i,circumcenters:e,delaunay:{halfedges:n,hull:s}}=this;for(let i=0,s=n.length;i<s;++i){const s=n[i];if(s<i)continue;const h=2*Math.floor(i/3),r=2*Math.floor(s/3);t.moveTo(e[h],e[h+1]),t.lineTo(e[r],e[r+1])}let h=s;do{const n=2*Math.floor(h.t/3),s=e[n],r=e[n+1],l=this._project(s,r,i[h.i].vn);l&&(t.moveTo(s,r),t.lineTo(l[0],l[1]))}while((h=h.next)!==s)}renderBounds(t){t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin)}_clip(t,i,e){return i?this._clipInfinite(t,i,e):this._clipFinite(t)}_clipFinite(t){const i=t.length;let n,s,h,r,l,o,a=null,c=t[i-2],f=t[i-1],u=this._regioncode(c,f);for(let e=0;e<i;e+=2)if(s=c,h=f,c=t[e],f=t[e+1],r=u,u=this._regioncode(c,f),0===r&&0===u)l=o,o=0,a?a.push(c,f):a=[c,f];else if(n=this._clipSegment(s,h,c,f,r,u)){const[i,e,s,h]=n;r&&(l=o,o=this._edgecode(i,e),l&&o&&this._edge(t,l,o,a),a?a.push(i,e):a=[i,e]),l=o,o=this._edgecode(s,h),l&&o&&this._edge(t,l,o,a),a?a.push(s,h):a=[s,h]}if(a)l=o,o=this._edgecode(a[0],a[1]),l&&o&&this._edge(t,l,o,a);else if(e(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,i,e,n,s,h){for(;;){if(0===s&&0===h)return[t,i,e,n];if(s&h)return;let r,l,o=s||h;8&o?(r=t+(e-t)*(this.ymax-i)/(n-i),l=this.ymax,o^=8):4&o?(r=t+(e-t)*(this.ymin-i)/(n-i),l=this.ymin,o^=4):2&o?(l=i+(n-i)*(this.xmax-t)/(e-t),r=this.xmax,o^=2):(l=i+(n-i)*(this.xmin-t)/(e-t),r=this.xmin,o^=1),s?(t=r,i=l,s=o):(e=r,n=l,h=o)}}_clipInfinite(t,i,e){let s,h=Array.from(t);if((s=this._project(h[0],h[1],i))&&h.unshift(s[0],s[1]),(s=this._project(h[h.length-2],h[h.length-1],e))&&h.unshift(s[0],s[1]),h=this._clipFinite(h)){for(let s,r=0,l=h.length,o=this._edgecode(h[l-2],h[l-1]);r<l;r+=2)if(s=o,o=this._edgecode(h[r],h[r+1]),s&&o)for(;s!==o;){let o,a;switch(s){case 5:s=4;continue;case 4:s=6,o=this.xmax,a=this.ymin;break;case 6:s=2;continue;case 2:s=10,o=this.xmax,a=this.ymax;break;case 10:s=8;continue;case 8:s=9,o=this.xmin,a=this.ymax;break;case 9:s=1;continue;case 1:s=5,o=this.xmin,a=this.ymin}n(t,i,e,o,a)&&(h.splice(r,0,o,a),l+=2,r+=2)}}else n(t,i,e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&h.push(this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax);return h}_edge(t,i,n,s){for(;i!==n;){let n,h;switch(i){case 5:i=4;continue;case 4:i=6,n=this.xmax,h=this.ymin;break;case 6:i=2;continue;case 2:i=10,n=this.xmax,h=this.ymax;break;case 10:i=8;continue;case 8:i=9,n=this.xmin,h=this.ymax;break;case 9:i=1;continue;case 1:i=5,n=this.xmin,h=this.ymin}e(t,n,h)&&s.push(n,h)}}_project(t,i,[e,n]){let s,h,r,l=1/0;if(n<0){if(i<=this.ymin)return;(s=(this.ymin-i)/n)<l&&(r=this.ymin,h=t+(l=s)*e)}else if(n>0){if(i>=this.ymax)return;(s=(this.ymax-i)/n)<l&&(r=this.ymax,h=t+(l=s)*e)}if(e>0){if(t>=this.xmax)return;(s=(this.xmax-t)/e)<l&&(h=this.xmax,r=i+(l=s)*n)}else if(e<0){if(t<=this.xmin)return;(s=(this.xmin-t)/e)<l&&(h=this.xmin,r=i+(l=s)*n)}return[h,r]}_edgecode(t,i){return(t===this.xmin?1:t===this.xmax?2:0)|(i===this.ymin?4:i===this.ymax?8:0)}_regioncode(t,i){return(t<this.xmin?1:t>this.xmax?2:0)|(i<this.ymin?4:i>this.ymax?8:0)}}class y{constructor(t,i,e,n){this.points=t,this.halfedges=i,this.hull=e,this.triangles=n}voronoi([t,e,n,s]=[0,0,960,500]){const{points:h,halfedges:r,hull:l,triangles:o}=this,a=new Array(h.length/2),c=new Float64Array(o.length/3*2),f=new d(a,c,this,t,e,n,s);for(let t=0,e=a.length;t<e;++t)a[t]=new i(f);for(let t=0,i=r.length;t<i;++t){const i=o[t],e=a[i].triangles;if(e.length)continue;let n=t;do{if(e.push(Math.floor(n/3)),-1===(n=r[n]))break;if(o[n=n%3==2?n-2:n+1]!==i)break}while(n!==t);if(n!==t)for(n=t;-1!==(n=r[n%3==0?n+2:n-1])&&o[n]===i;)e.unshift(Math.floor(n/3));else e.push(e[0])}for(let t=0,i=a.length;t<i;++t){const i=a[t];0===i.triangles.length&&(i.triangles=null)}for(let t=0,i=0,e=o.length;t<e;t+=3,i+=2){const e=2*o[t],n=2*o[t+1],s=2*o[t+2],r=h[e],l=h[e+1],a=h[n],f=h[n+1],u=h[s],x=h[s+1],g=r-a,m=r-u,d=l-f,y=l-x,v=r*r+l*l,_=v-a*a-f*f,p=v-u*u-x*x,w=2*(m*d-g*y);c[i]=(d*p-y*_)/w,c[i+1]=(m*_-g*p)/w}{let t=l;do{const{x:i,y:e,t:n,next:{x:s,y:h,t:r}}=t,l=2*Math.floor(n/3),f=c[l],u=c[l+1],x=(i+s)/2-f,g=(e+h)/2-u,m=(s-i)*(u-e)>(h-e)*(f-i)?-1:1;a[o[n]].vn=a[o[r]].v0=[m*x,m*g]}while((t=t.next)!==l)}return f}render(t){const{points:i,halfedges:e,triangles:n}=this;for(let s=0,h=e.length;s<h;++s){const h=e[s];if(h<s)continue;const r=2*n[s],l=2*n[h];t.moveTo(i[r],i[r+1]),t.lineTo(i[l],i[l+1])}this.renderHull(t)}renderHull(t){const{hull:i}=this;let e=i;do{t.moveTo(e.x,e.y),t.lineTo(e.next.x,e.next.y)}while((e=e.next)!==i)}renderTriangle(t,i){const{points:e,triangles:n}=this,s=2*n[t*=3],h=2*n[t+1],r=2*n[t+2];i.moveTo(e[s],e[s+1]),i.lineTo(e[h],e[h+1]),i.lineTo(e[r],e[r+1]),i.closePath()}}y.from=function(t,i,e){const{coords:n,halfedges:h,hull:r,triangles:l}=new s(t,i,e);return new y(n,h,r,l)},t.Cell=i,t.Delaunay=y,t.Voronoi=d,Object.defineProperty(t,"__esModule",{value:!0})});
